<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skynap</title>
    <meta name="mobile-web-app-capable" content="yes">
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

        <!-- Your custom script -->
        <script>
            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyD4kYnLgUzzIZt1XUWL9DEQ5j-YhbE1C_0",
                authDomain: "farm-monitoring-7d029.firebaseapp.com",
                projectId: "farm-monitoring-7d029",
                storageBucket: "farm-monitoring-7d029.appspot.com",
                messagingSenderId: "205970011096",
                appId: "1:205970011096:web:5a0718eb27438d499af8ad"
            };

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            // Reference Firebase Auth and Storage
            const auth = firebase.auth();
            const storage = firebase.storage();

            // Display user profile
            function displayUserProfile() {
                const userEmail = localStorage.getItem('email');
                const userId = auth.currentUser ? auth.currentUser.uid : null; // Get user ID

                // Display email
                document.getElementById("email").textContent = userEmail;

                // Fetch profile picture from Firebase Storage
                if (userId) {
                    const profilePicRef = storage.ref(`profile_pictures/${userId}.jpg`);
                    profilePicRef.getDownloadURL()
                        .then((url) => {
                            document.getElementById("profile-pic").src = url;
                        })
                        .catch((error) => {
                            console.error("Error fetching profile picture:", error);
                        });
                }
            }

            // Upload profile photo
            document.getElementById('uploadBtn').addEventListener('click', function() {
                const fileInput = document.getElementById("upload-photo");
                const file = fileInput.files[0];
                const userId = auth.currentUser ? auth.currentUser.uid : null; // Get user ID

                if (file && userId) {
                    const storageRef = storage.ref(`profile_pictures/${userId}.jpg`);
                    const uploadTask = storageRef.put(file);

                    uploadTask.on("state_changed",
                        (snapshot) => {
                            // Handle progress here if needed
                        },
                        (error) => {
                            console.error("Error uploading file:", error);
                        },
                        () => {
                            // Get the download URL and update the profile picture
                            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                document.getElementById("profile-pic").src = downloadURL; // Update profile picture
                            });
                        }
                    );
                } else {
                    alert("Please select a file to upload.");
                }
            });

            // Logout function
            function logout() {
                auth.signOut().then(() => {
                    localStorage.removeItem('email'); // Clear the stored email
                    window.location.href = "index.html"; // Redirect to login page
                }).catch((error) => {
                    console.error("Error signing out: ", error);
                });
            }

            // Call displayUserProfile when the page loads
            window.onload = function() {
                displayUserProfile();
            };
        </script>
    

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: url('src/SKYSNAP_back.jpg') no-repeat center center fixed;
            background-size: cover;
            overflow-x: hidden;
        }
        /* Container for the main content */
            #main .p {
                padding: 20px;
                /* Ensure the content stays in place */
                transition: margin-left 0.3s ease;
                margin-left: 0; /* Ensure initial margin is zero */
                height: 100vh; /* Set height to viewport height */
                overflow-y: auto; /* Enable vertical scrolling */
            }
            .logor {
                text-align: center; /* Centers the text and inline elements */
                position: relative; /* Allows for positioning child elements */
            }

            .logor img {
                display: block; /* Removes inline spacing issues */
                margin: 0 auto; /* Centers the image horizontally */
                width: 150px;
                height: 150px; /* Maintains the aspect ratio */
                padding-top: 20px;
                border-color: #45a049;
                border: #333;
                padding-bottom: 5px;
            }

        .header {
            text-align: center;
            padding: 10px;
            background-color: rgba(138, 255, 138, 0.8);
            position: relative;
            
        }
        .header img {
            max-width: 50px;
        }
        .header h1 {
            margin: 5px 0 0;
            font-size: 1.5em;
            color: #333;
            
        }
        .menu-icon {
            position: absolute;
            left: 15px;
            top: 15px;
            cursor: pointer;
            width: 50px;
            height: 50px;
        }
        .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 3;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #4CAF50, #9CCC65);
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
        }
        .sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            font-size: 1em;
            color: #ffffff;
            display: block;
            transition: 0.3s;
        }
        .sidebar a:hover {
            color: #f1f1f1;
        }
        .sidebar .closebtn {
            position: absolute;
            top: 0;
            right: 15px;
            font-size: 36px;
            margin-left: 50px;
        }
        #main {
            transition: margin-left .5s;
            padding-top: 5px;
            padding: 16px;
            overflow-y: auto; /* Allow vertical scrolling */
            height: 100vh; /* Full height to enable vertical scrolling */
            box-sizing: border-box; /* Ensure padding is included in height */
            position: relative;
            
        }
        
         #main h1 {
              text-align: center; /* Centers the text */
                position: relative;
                font-size: 30px;
                
            }

            #main p {
                text-align: justify; /* Justifies the text */
                position: relative;
                font-size: 18px;
                
            }

        .main-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }
        .main-buttons button {
            width: 80%;
            padding: 10px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .main-buttons button:hover {
            background-color: #45a049;
        }
        .prediction-results {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }
        .prediction-results img {
            max-width: 100%;
            border-radius: 10px;
        }
        .prediction-results h2 {
            margin-top: 0;
        }
        .prediction-results p {
            font-size: 1em;
            color: #333;
        }
                        /* profile.css */

                .profile-section {
                    padding: 15px;
                    border-top: 1px solid #ccc;
                    margin-top: 20px;
                }

                .profile-section h3 {
                    font-size: 1.5em;
                    margin-bottom: 10px;
                    color: #333;
                    text-align: center;
                }

                .profile-pic {
                    width: 100px;
                    height: 100px;
                    border-radius: 50%;
                    object-fit: cover;
                    display: block;
                    margin-bottom: 10px;
                    
                    justify-content: center; /* Center horizontally */
                    align-items: center;    /* Center vertically if needed */
                    margin: 20px;          /* Add some margin if needed */
                }

                

                .profile-upload {
                    display: block;
                    margin-bottom: 10px;
                    font-size: 1em;
                    padding: 5px;
                }

                .profile-button {
                    background-color: #4CAF50;
                    color: white;
                    border: none;
                    padding: 10px 15px;
                    text-align: center;
                    font-size: 1em;
                    cursor: pointer;
                    width: 100%;
                }

                .profile-button:hover {
                    background-color: #45a049;
                }

                #user-email {
                    margin-bottom: 10px;
                    font-size: 1em;
                }

                #user-email span {
                    font-weight: bold;
                }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0/dist/tf.min.js"></script>
    <!-- Load Teachable Machine Library -->
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
</head>
<body>

    <div class="header">
        <a href="https://www.facebook.com/MinSUITSocietyCCSMain?mibextid=LQQJ4d" target="_blank">
            <img src="src/logo1.jpg" alt="Drone">
        </a>
        
        <a href="https://www.facebook.com/mindorostateuccs?mibextid=LQQJ4d" target="_blank">
            <img src="src/logo2.jpg" alt="Drone">
        </a>
        
        <a href="https://www.facebook.com/TheMinSUOfficial?mibextid=LQQJ4d" target="_blank">
            <img src="src/logo3.jpg" alt="Drone">
        </a>
        
        <img src="src/menu.jpg" alt="Menu Icon" class="menu-icon" onclick="openNav()">
    </div>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">Ã—</a>
    
        <!-- Profile Section -->
        <div class="profile-section">
            <h3>User Profile</h3>
            <img id="profile-pic" src="default-profile.jpg" alt="fjkgjkfnjkfdngjkhgjnbfjbnjgk" class="profile-pic">
            <p id="user-email"> email<span></span></p>
            <input type="file" id="upload-photo" accept="image/*" class="profile-upload">
            <button class="profile-button" onclick="uploadProfilePhoto()">Upload Photo</button>
        </div>
    
        <a href="#" onclick="goToRiceFieldStatus()">
            <i class="fas fa-seedling"></i> Kalagayan ng Palayan
        </a>
        <a href="disease1.html">
            <i class="fas fa-disease"></i> Pagtuklas ng Sakit
        </a>
        <a href="pest_detection.html">
            <i class="fas fa-bug"></i> Pagtuklas ng Peste
        </a>
        <a href="library.html">
            <i class="fas fa-book"></i> Aklatan ng mga Peste/Sakit
        </a>
        <br>
        <br>
        <!-- Logout Button -->
        <a href="index.html" style="text-align: center;">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </div>
    
    

    <div class="logor"><img src="src/drone.jpg" alt="Drone"></div> 
        <div id="main">
           
            <h1>Magandang araw Ka-SkyFarmer!</h1>
            <p>Ang Skysnap ay isang espesyal na website na dinisenyo upang tulungan ang mga magsasaka sa pagsusuri ng kanilang mga palay na pananim. Ang layunin namin ay magbigay sa mga magsasaka ng mga kasangkapan na kailangan nila upang masubaybayan ang kalusugan ng kanilang mga pananim, tukuyin ang mga problema, at magbigay imporamasyon upang makatulong sa maaring gawin upang magkaroon ng magandang ani.</p>
            <p>Sa pamamagitan ng paggamit ng makabagong teknolohiya, pinadali ng Skysnap ang pagsusuri ng palay. Gaya ng ibang website ang Skysnap ay may limitasyon. Kaya lamang nitong sumuri at kumlasipika ng 8 karamdaman, 11 peste ng palay, 3 uri ng sira sa palay dulot ng kalamidad at kung ang palay ay maari ng anihin o hindi. Nawa ay magustuhan niyo aming handog.</p>
        </div>
        
</div>
    </div>

    <script>
        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
            document.getElementById("main").style.marginLeft = "250px";
            document.getElementById("main").style.opacity = "0"; // Make main invisible
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
            document.getElementById("main").style.marginLeft = "0";
            document.getElementById("main").style.opacity = "100"; // Make main visible
        }

        function goToRiceFieldStatus() {
            const statusPageHtml = `
                <div class="main-buttons">
                    <button onclick="openLwFly()">Drone Vision</button>
                    <button onclick="classifyImage()">I-classify ang Imahe</button>
                </div>
                <div id="webcam-container"></div>
                <div id="label-container"></div>`;
            document.getElementById("main").innerHTML = statusPageHtml;
            closeNav();
        }

        function openLwFly() {
            // Android-specific code to open LW Fly app
            window.location.href = "intent:#Intent;action=android.intent.action.MAIN;category=android.intent.category.LAUNCHER;package=com.lwcx.lw119;end";
        }

        async function classifyImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    const image = document.createElement('img');
                    image.src = URL.createObjectURL(file);
                    image.onload = async () => {
                        const resultsDiv = document.createElement('div');
                        resultsDiv.className = 'prediction-results';
                        resultsDiv.innerHTML = `<img src="${image.src}" alt="Uploaded Image"><h2>Mga Prediksyon</h2>`;
                        document.getElementById("main").appendChild(resultsDiv);

                        try {
                            // Load and run the ripening stage model
                            const ripeningModelURL = "https://teachablemachine.withgoogle.com/models/7V236RqnY/model.json";
                            const ripeningMetadataURL = "https://teachablemachine.withgoogle.com/models/7V236RqnY/metadata.json";
                            const ripeningModel = await tmImage.load(ripeningModelURL, ripeningMetadataURL);
                            const ripeningPrediction = await ripeningModel.predict(image);

                            // Find the ripening prediction with the highest confidence
                            const highestRipeningPrediction = ripeningPrediction.reduce((prev, current) => 
                                (prev.probability > current.probability) ? prev : current);

                            // Display the ripening prediction
                            const ripeningPercent = (highestRipeningPrediction.probability * 100).toFixed(2);
                            let ripeningResultText = "";
                            if (highestRipeningPrediction.className === "Ripe" && ripeningPercent >= 85) {
                                ripeningResultText = `<p style="color:green;">${highestRipeningPrediction.className}: ${ripeningPercent}%</p>`;
                            } else if (highestRipeningPrediction.className === "Ripe" && ripeningPercent < 85) {
                                ripeningResultText = `<p style="color:red;">Hilaw: ${ripeningPercent}%</p>`;
                            } else {
                                ripeningResultText = `<p>${highestRipeningPrediction.className}: ${ripeningPercent}%</p>`;
                            }
                            resultsDiv.innerHTML += ripeningResultText;

                            // Load and run the rice field status model
                            const statusModelURL = "https://teachablemachine.withgoogle.com/models/rYYZnO5oA/model.json";
                            const statusMetadataURL = "https://teachablemachine.withgoogle.com/models/rYYZnO5oA/metadata.json";
                            const statusModel = await tmImage.load(statusModelURL, statusMetadataURL);
                            const statusPrediction = await statusModel.predict(image);

                            // Find the rice field status prediction with the highest confidence
                            const highestStatusPrediction = statusPrediction.reduce((prev, current) => 
                                (prev.probability > current.probability) ? prev : current);

                            // Display the highest status prediction
                            const statusPercent = (highestStatusPrediction.probability * 100).toFixed(2);
                            resultsDiv.innerHTML += `<h2>Status ng Palayan</h2><p>${highestStatusPrediction.className}: ${statusPercent}%</p>`;

                            // If the result is "Dapa," "Tuyo," or "Baha," display recommendations from Firebase
                            const recommendations = {
                                "Baha": {
                                    "name": "Flood Management",
                                    "description": "Ang pagpapamahala at paglutas ng baha sa mga palayan ay mahalaga upang mapanatili ang kalusugan ng pananim at maksimisahin ang ani. Narito ang ilang epektibong paraan para sa pagpapamahala ng baha sa mga palayan:",
                                    "remedies": [
                                        "Tamang Paghahanda ng Lupa at Disenyo ng Sakahan: Magtayo ng matibay na levees o bunds sa paligid ng mga palayan upang maiwasan ang pag-apaw ng tubig sa panahon ng matinding ulan o baha. Siguraduhing maayos ang pagtaas at pagpapantay ng lupa sa sakahan upang mapadali ang maayos na pagtulo ng tubig at maiwasan ang pagbabaha.",
                                        "Pinaayos na Sistema ng Irrigasyon: Regular na linisin at alagaan ang mga kanal ng irigasyon at mga sistema ng drainage upang mapanatili ang magandang daloy ng tubig at maiwasan ang pagbabara. Maglagay ng mga estruktura tulad ng mga pintuang kontrol ng tubig at mga dam upang mapanatili ang antas ng tubig at daloy sa loob ng mga palayan.",
                                        "Pamamahala sa Pananim at Lupa: Itanim ang mga uri ng palay na matibay sa baha o kayang magtagal sa matagal na pagbabaha nang hindi masyadong naapektuhan ang ani. Piliin ang tamang panahon ng pagtatanim ayon sa lokal na klima upang maiwasan ang panahon ng mataas na banta ng baha. Ayusin ang pag-aplay ng pataba upang mabawasan ang pagtakbo ng tubig at pagkawala ng sustansiya sa panahon ng baha.",
                                        "Paghahanda sa Emergency: Magpatupad ng mga sistema ng pagmamanman para sa pagsubaybay sa weather forecast, antas ng tubig, at kalagayan ng sakahan. Gumawa at ipatupad ng mga plano para sa emergency na kasama ang mga hakbang para sa pag-evacuate ng tubig, proteksyon sa mga pananim, at kaligtasan ng mga magsasaka sa panahon ng baha.",
                                        "Integrated Pest and Disease Management: Bantayan ang mga sakit na maaaring lumitaw pagkatapos ng baha, tulad ng mga fungal infection, at mag-apply ng tamang paggamot kung kinakailangan.",
                                        "Pakikipagtulungan sa Komunidad at Pamahalaan: Makipagtulungan sa mga kapwa magsasaka at komunidad upang pamahalaan ang antas ng tubig ng sabay-sabay at magbahagi ng mga mapagkukunan para sa pagkontrol ng baha. Humingi ng tulong mula sa mga ahensya ng pamahalaan para sa imprastraktura ng baha, subsidiya para sa mga uri ng pananim na matibay sa baha, at mga programa para sa relief sa sakuna."
                                    ]
                                },
                                "Dapa": {
                                    "name": "Lodging Management (Dapa)",
                                    "description": "Sa konteksto ng agrikultura, ang 'dapa' ay tumutukoy sa pagkakabuwal o pagkakalas ng mga halaman ng palay. Ito ay maaaring mangyari dahil sa mabigat na ulan, malakas na hangin, o dahil sa hindi magandang kalagayan ng mga halaman.",
                                    "remedies": [
                                        "Paghahanda ng Sakahan: Siguruhing maayos ang pagpapatag ng lupa at sistema ng pagdaloy ng tubig upang maiwasan ang pagbabaha, na maaaring magpahina sa mga halaman ng palay at magdulot ng pagkakabuwal.",
                                        "Pamamahala sa Pananim: Pumili ng mga uri ng palay na hindi gaanong prone sa pagkakabuwal. Iwasan ang labis na paglalagay ng pataba ng nitrogen, na maaaring magdulot ng labis na paglago ng halaman at dagdag na panganib sa pagkakabuwal.",
                                        "Tamang Pag-aani: Aanihin ang palay sa tamang pagkakataon upang mabawasan ang panganib ng pagkakabuwal habang ang mga halaman ay nagiging mabigat na dahil sa mga butil.",
                                        "Mekanikal na Suporta: Gumamit ng mga tukod o iba pang mekanikal na suporta upang itayo ang mga halaman ng palay kung sakaling magkaroon ng pagkakabuwal bago ang tamang panahon.",
                                        "Pamamahala ng Peste at Sakit: Kontrolin ang mga peste at sakit na maaaring magpahina sa mga halaman ng palay at magdulot ng pagkakabuwal."
                                    ]
                                },
                                "Tuyo ang Lupa": {
                                    "name": "Drought Management",
                                    "description": "Sa konteksto ng agrikultura, ang tagtuyot o drought ay isang malubhang suliranin sa mga palayan, lalo na sa mga lugar na umaasa sa ulan o tubig-ilog para sa irigasyon ng kanilang mga taniman. Narito ang ilang mga hakbang na maaaring gawin upang pamahalaan ang tagtuyot sa mga palayan:",
                                    "remedies": [
                                        "Paghahanda ng Lupa: Bago magkaroon ng tagtuyot, siguraduhing maayos ang paghahanda ng lupa tulad ng tamang pagpapatag at pagpapatibay ng mga taniman. Ito ay makakatulong sa pagtulong ng tubig sa lupa at pag-iwas sa pagkasira ng mga pananim.",
                                        "Pagtatanim ng Matibay na Varieties: Pumili ng mga uri ng palay na matibay sa tagtuyot o may kakayahan na magtagal ng maikling supply ng tubig. Ang mga ito ay karaniwang tinatawag na drought-resistant varieties.",
                                        "Pagtitipid ng Tubig: Itaguyod ang mga pamamaraan ng pagsisiguro ng tubig tulad ng teknolohiya ng patak-patak o drip irrigation. Ang mga ito ay makakatulong na tiyakin ang tamang paggamit at distribusyon ng tubig sa palayan.",
                                        "Mga Teknikal na Pamamaraan: Subukan ang mga modernong teknik tulad ng mulching o paglalagay ng plastic sa lupa upang maiwasan ang pag-evaporate ng tubig mula sa lupa. Paggamit ng mga cover crop na may kakayahan na magbigay ng shade at panatilihin ang tamang halumigmig sa lupa.",
                                        "Monitoring at Early Warning Systems: Magpatupad ng mga sistema ng pagmamanman para sa weather forecast at kondisyon ng lupa. Ito ay makakatulong sa maagang pagtukoy at pagtugon sa mga problema na dulot ng tagtuyot.",
                                        "Pagpaplano sa Pag-ani: Planuhin ang pag-ani ng palay sa tamang panahon upang mabawasan ang epekto ng tagtuyot sa ani."
                                    ]
                                }
                            };

                            if (["Dapa", "Tuyo ang Lupa", "Baha"].includes(highestStatusPrediction.className)) {
                                const rec = recommendations[highestStatusPrediction.className];
                                resultsDiv.innerHTML += `
                                    <h2>Rekomendasyon: ${rec.name}</h2>
                                    <p>${rec.description}</p>
                                    <ul>${rec.remedies.map(remedy => `<li>${remedy}</li>`).join('')}</ul>
                                `;
                            }

                            // Add "Muling Magklasipika" button
                            const reclassifyBtn = document.createElement('button');
                            reclassifyBtn.textContent = "Muling Magklasipika";
                            reclassifyBtn.style.marginTop = "20px";
                            reclassifyBtn.onclick = () => {
                                document.getElementById("main").removeChild(resultsDiv);
                                classifyImage();
                            };
                            resultsDiv.appendChild(reclassifyBtn);

                        } catch (error) {
                            console.error('Error during prediction:', error);
                            resultsDiv.innerHTML += `<p style="color:red;">Error: ${error.message}</p>`;
                        }
                    };
                }
            };
            input.click();
        }
    </script>

</body>
</html>
